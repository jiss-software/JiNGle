var JiNGle=function(){var conf={rootPath:"",scriptPath:"",viewPath:""},scripts=document.getElementsByTagName("script"),currentPath=scripts[scripts.length-1].src;return conf.rootPath=currentPath.substring(0,currentPath.lastIndexOf("/js/")+1),conf.scriptPath=conf.rootPath+"js/",conf.viewPath=conf.rootPath+"views/",conf}();angular.module("JiNGle.directives",[]),angular.module("JiNGle.filters",[]),angular.module("JiNGle.interceptor",[]),window.notyData={loadingQty:0,loading:null},angular.module("JiNGle.interceptor").factory("HttpInterceptor",function($q){var progressBar='<div class="progress"><div class="progress-bar progress-bar-striped active" role="progressbar" style="width: 100%"></div></div>',isSystemCall=function(method,url){return"GET"==method.toUpperCase()&&(url.endsWith(".html")||url.endsWith(".js")||url.endsWith(".json"))||url.has("/lib/")||url.has("system")};return{request:function(config){return isSystemCall(config.method,config.url)?config:(console.log("Request: "+config.method+" - "+config.url),"GET"==config.method.toUpperCase()?config:(window.notyData.loadingQty++,window.notyData.loading||(window.notyData.loading=noty({text:"Loading...<br />"+progressBar,timeout:!1,killer:!0})),config))},response:function(response){return isSystemCall(response.config.method,response.config.url)||"GET"==response.config.method.toUpperCase()?response||$q.when(response):(window.notyData.loadingQty--,window.notyData.loadingQty<1&&(window.notyData.loading&&(window.notyData.loading.close(),window.notyData.loading=null),window.notyData.loadingQty=0),noty({text:"Done",type:"success"}),response||$q.when(response))},responseError:function(rejection){if(!rejection.config)return noty({text:"System error",type:"danger"}),void console.log(rejection.message);if(isSystemCall(rejection.config.method,rejection.config.url)||"GET"==rejection.config.method.toUpperCase())return $q.reject(rejection);switch(window.notyData.loadingQty--,window.notyData.loadingQty<1&&(window.notyData.loading.close(),window.notyData.loading=null,window.notyData.loadingQty=0),rejection.status){case 400:noty({text:"Validation error",type:"warning"});break;case 409:noty({text:"Somebody make conflicting changes",type:"warning"});break;case 500:noty({text:"System error",type:"danger"})}return $q.reject(rejection)}}}),angular.module("JiNGle.directives").directive("jibreadcrumbs",function(){"use strict";return{restrict:"AE",replace:"true",templateUrl:JiNGle.viewPath+"BreadcrumbsDirective.html",scope:{nodes:"=nodes"},link:function($scope){$scope.isActive=function(node){return"undefined"!=typeof node.active&&node.active||node===$scope.nodes[$scope.nodes-1]}}}}),angular.module("JiNGle.directives").directive("jifield",function($filter){"use strict";return{restrict:"AE",replace:"true",templateUrl:JiNGle.viewPath+"FieldDirective.html",transclude:!0,scope:{id:"@",name:"@",label:"@",type:"@",value:"=",wrong:"=",options:"=?",disabled:"=?",validation:"=?"},link:function($scope){$scope.id=$scope.id||$scope.name||"field_"+Math.floor(1e7*Math.random()+1),$scope.type=$scope.type||"text";var translator=$filter("i18n");$scope.printValue=function(option){return option?option.value||option.name||option.code||option:void 0},$scope.printName=function(option){return option?option.name?option.name:option.code?translator(option.code):option.value||option.code||option.code||option:void 0},$scope.type=-1==["select","textarea","html"].indexOf($scope.type)?"text":$scope.type,$scope.fieldLength=-1==["textarea","html"].indexOf($scope.type)?8:5}}}),angular.module("JiNGle.directives").directive("jiform",function(){"use strict";return{restrict:"AE",replace:"true",templateUrl:JiNGle.viewPath+"FormDirective.html",transclude:!0,scope:{id:"@id",disabled:"=disabled",cancel:"@cancel",save:"&save"},link:function($scope,element,attrs){$scope.saveSet="undefined"!=typeof attrs.save,jQuery(document).bind("keydown",function(e){return e.ctrlKey&&83===e.which?(e.preventDefault(),$scope.save(),!1):!0})}}}),angular.module("JiNGle.directives").directive("jiservertable",function($http){"use strict";return{restrict:"AE",replace:"true",templateUrl:JiNGle.viewPath+"ServerTableDirective.html",scope:{columns:"=columns",source:"@source",create:"@create",show:"@show",pdf:"@pdf",edit:"@edit",remove:"@delete"},link:function($scope,element,attrs){var load=function(){$scope.ready=!1;var selection={skip:$scope.collection.skip,limit:$scope.collection.limit,query:$scope.collection.query||"",filter:$scope.collection.filter,order:$scope.collection.sortOrder};$http.put(attrs.source,selection).success(function(data){$scope.collection=data,$scope.page=Math.ceil((data.skip||0)/data.limit)+1,$scope.pageQuantity=Math.ceil(data.selectionSize/data.limit),$scope.ready=!0})};$scope.sizes=[5,10,25,50,100],$scope.ready=!1,$scope.page=1,$scope.pageQuantity=1,$scope.pagesInSelector=10,$scope.collection={collectionSize:0,selectionSize:0,skip:0,limit:$scope.sizes[2],query:"",filter:{},sortOrder:{},data:[],meta:{}},$scope.isSortedAsc=function(field){return $scope.collection.sortOrder&&1===$scope.collection.sortOrder[field]},$scope.isSortedDesc=function(field){return $scope.collection.sortOrder&&-1===$scope.collection.sortOrder[field]},$scope.isFiltered=function(field){return $scope.collection.filter[field]},$scope.sortName=function(field){var rule={};$scope.isSortedAsc(field)?rule[field]=-1:$scope.isSortedDesc(field)?$scope.collection.meta[field]&&$scope.collection.meta[field].defaultSort&&1===Object.keys($scope.collection.sortOrder).length&&$scope.collection.sortOrder[field]&&(rule[field]=1):rule[field]=1,Object.keys($scope.collection.sortOrder,function(key){key!=field&&(rule[key]=$scope.collection.sortOrder[key])}),$scope.collection.sortOrder=rule,load()},$scope.settings={pageSize:$scope.collection.limit},$scope.changeSettings=function(){$scope.collection.limit=$scope.settings.pageSize,$scope.collection.skip=0,load()},$scope.startSearch=function(){$scope.collection.skip=0,$scope.collection.query=$scope.settings.query,load()},$scope.goToPage=function(page){$scope.collection.skip=(page-1)*$scope.settings.pageSize,load()},$scope.cellStyle=function(row,column){return column.style?column.field?column.style(row[column.field]):column.style(row):{}},$scope.cellFormat=function(row,column){return column.format?column.field?column.format(row[column.field]):column.format(row):row[column.field]},$scope.asRow=function(value,field){var row={};return row[field]=value,row},$scope.isVisibleSelector=function(page){return 1==page||page==$scope.pageQuantity||page<=$scope.page+$scope.pagesInSelector&&page>=$scope.page-$scope.pagesInSelector},load()}}}),angular.module("JiNGle.directives").directive("jitable",function($filter){"use strict";return{restrict:"AE",replace:"true",templateUrl:JiNGle.viewPath+"TableDirective.html",scope:{columns:"=columns",data:"=data",create:"@create",show:"@show",pdf:"@pdf",edit:"@edit",remove:"@delete"},link:function($scope,element,attrs){$scope.defaultFormatter=$filter("ji_inline"),$scope.sortRule=[],attrs.sort&&attrs.sort.words(function(field){$scope.sortRule.push(field)}),$scope.isSortedAsc=function(field){return-1!==this.sortRule.indexOf(field)},$scope.isSortedDesc=function(field){return-1!==this.sortRule.indexOf("-"+field)},$scope.sortName=function(field){var index=$scope.sortRule.indexOf(field);return-1===index?(index=$scope.sortRule.indexOf("-"+field),-1===index?void $scope.sortRule.unshift(field):void $scope.sortRule.splice(index,1)):($scope.sortRule.splice(index,1),void $scope.sortRule.unshift("-"+field))}}}}),angular.module("JiNGle.filters").filter("ji_checkmark",function(){"use strict";return function(input,no,yes){return input?yes||"✓":no||"✘"}}),angular.module("JiNGle.filters").filter("i18n",function($parse,I18nService){"use strict";return function(key){var translation=$parse(key)(I18nService.getCache());if(translation)for(var i=1;arguments.length>i;i++)translation=translation.split("{"+(i-1)+"}").join(arguments[i]);return translation}}),angular.module("JiNGle.filters").filter("ji_inline",function(){"use strict";return function(input,maxLength,side){if("string"!=typeof input)return input;var short=input.words().join(" ");return!maxLength||short.length<=maxLength?short:short.truncateOnWord(maxLength-3,side)}}),angular.module("JiNGle.filters").filter("range",function(){"use strict";return function(end,start,step,reverse){end=parseInt("0"|end),start=parseInt("0"|start),step=parseInt("1"|step);var result=[],i=0;if(reverse)for(i=end;i>=start;i-=step)result.push(i);else for(i=start;end>=i;i+=step)result.push(i);return result}});